{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Accounts | RDFS{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'styles/accounts/manage-users.css' %}?v=2">

<div class="container manage-users-page">

  <!-- HEADER -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-users-cog me-2"></i>
        Manage Accounts
      </h1>
      <p class="page-subtitle">
        <i class="fas fa-info-circle me-1"></i>
        View, create, edit, and manage admin and staff accounts
      </p>
    </div>

    <a href="{% url 'accounts:create_user' %}" class="btn-create">
      <i class="fas fa-user-plus me-2"></i>
      Create New Account
    </a>
  </div>

  <!-- STATS CARDS -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon admin-icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ users|length }}</div>
        <div class="stat-label">Total Users</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon admin-icon">
        <i class="fas fa-user-shield"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ admin_count }}</div>
        <div class="stat-label">Admins</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon staff-icon">
        <i class="fas fa-user-tie"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ staff_admin_count }}</div>
        <div class="stat-label">Staff Admins</div>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon treasurer-icon">
        <i class="fas fa-coins"></i>
      </div>
      <div class="stat-info">
        <div class="stat-value">{{ treasurer_count }}</div>
        <div class="stat-label">Treasurers</div>
      </div>
    </div>
  </div>

  <!-- USERS TABLE -->
  <div class="users-card">
    <div class="card-header">
      <h2 class="card-title">
        <i class="fas fa-list me-2"></i>
        User Accounts
      </h2>
      <div class="card-actions">
        <span class="user-count">{{ users|length }} user{{ users|length|pluralize }}</span>
      </div>
    </div>

    <div class="table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>
              <i class="fas fa-user me-1"></i>
              User
            </th>
            <th>
              <i class="fas fa-id-card me-1"></i>
              Name
            </th>
            <th>
              <i class="fas fa-envelope me-1"></i>
              Email
            </th>
            <th>
              <i class="fas fa-phone me-1"></i>
              Contact
            </th>
            <th>
              <i class="fas fa-id-badge me-1"></i>
              Role
            </th>
            <th class="text-center">
              <i class="fas fa-cog me-1"></i>
              Actions
            </th>
          </tr>
        </thead>

        <tbody>
          {% for user in users %}
          <tr class="user-row">
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                  <div class="user-name">{{ user.username }}</div>
                  <div class="user-id">ID: {{ user.id }}</div>
                </div>
              </div>
            </td>
            
            <td>
              <div class="user-fullname">
                {% if user.first_name or user.last_name %}
                  {{ user.first_name }} {{ user.last_name }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </div>
            </td>

            <td>
              <div class="user-email">
                <i class="fas fa-envelope me-2 text-muted"></i>
                {{ user.email_address|default:"—" }}
              </div>
            </td>
            
            <td>
              <div class="user-contact">
                <i class="fas fa-phone me-2 text-muted"></i>
                {{ user.contact_number|default:"—" }}
              </div>
            </td>

            <td>
              {% if user.role == 'admin' %}
                <span class="role-badge role-admin">
                  <i class="fas fa-shield-alt me-1"></i>
                  Admin
                </span>
              {% elif user.role == 'staff_admin' %}
                <span class="role-badge role-staff">
                  <i class="fas fa-user-tie me-1"></i>
                  Staff Admin
                </span>
              {% elif user.role == 'treasurer' %}
                <span class="role-badge role-treasurer">
                  <i class="fas fa-coins me-1"></i>
                  Treasurer
                </span>
              {% else %}
                <span class="role-badge role-unknown">
                  <i class="fas fa-question-circle me-1"></i>
                  Unknown
                </span>
              {% endif %}
            </td>

            <td>
              <div class="action-buttons">
                <a href="{% url 'accounts:edit_user' user.id %}" 
                   class="btn-action btn-edit"
                   title="Edit user">
                  <i class="fas fa-edit"></i>
                  <span>Edit</span>
                </a>

                {% if request.user.role == 'admin' %}
                <a href="{% url 'accounts:delete_user' user.id %}" 
                   class="btn-action btn-delete"
                   title="Delete user">
                  <i class="fas fa-trash-alt"></i>
                  <span>Delete</span>
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-users-slash"></i>
              </div>
              <div class="empty-text">No users found</div>
              <div class="empty-subtext">Create a new account to get started</div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
